# Render Blueprint
# Deploy with: https://render.com/docs/blueprint-spec
#
# This deploys News Bench as a web service with:
# - Automatic 12-hour news pipeline updates
# - Gunicorn for production performance
#
# Note: Free tier doesn't persist data between deploys.
# The scheduler rebuilds the database automatically.

services:
  - type: web
    name: news-bench
    runtime: python
    plan: free

    # Build settings - lightweight deps only (embeddings via Jina API)
    buildCommand: pip install -r requirements.txt

    # Start command - runs pipeline if needed, then starts gunicorn
    startCommand: python start.py

    # Environment variables
    envVars:
      - key: ENABLE_SCHEDULER
        value: "true"
      - key: GROQ_API_KEY
        sync: false  # Set manually in dashboard for security
      - key: JINA_API_KEY
        sync: false  # Get free key at: https://jina.ai/embeddings/
      - key: TURSO_DATABASE_URL
        sync: false  # Set manually: libsql://[db-name]-[org].turso.io
      - key: TURSO_AUTH_TOKEN
        sync: false  # Set manually: your Turso auth token
      - key: PYTHONUNBUFFERED
        value: "1"

    # Health check
    healthCheckPath: /api/health

    # Auto-deploy on push
    autoDeploy: true
